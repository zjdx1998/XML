(Do&&Do.ready?Do.ready:$)(function(){function t(t){return dui.Dialog($.extend({width:525},t),!0)}function e(t,e,a,n){t.submit(function(t){t.preventDefault();var i=$(this),o=i.attr("action");$.ajax({type:(i.attr("method")||"POST").toUpperCase(),url:o,data:$.map(i.serializeArray(),n||r),dataType:a,success:e,error:function(){e({r:!1,reason:"服务器开小差了，稍后再试吧"})}}),i.trigger("afterSubmit")})}function a(t,e){"end"===e&&(e=t.value.length),l(t,e,e)}function n(t){if(!t.data("isPollingForChange")){var e=t.val();setInterval(function(){var a=t.val();e!==a&&t.trigger("actualChange")},250)}}function i(t,e){var a=t.val().length,n=d-a,i=n<0;e.text(n.toString(10))[i?"addClass":"removeClass"]("error"),t.trigger(i?"limitExceed":"limitFufill")}function r(t){return t}function o(t){return t=t.clone(),t.find("[data-id]").each(function(t,e){e=$(e),e.text("@"+e.data("id"))}),t.text()}var d=140;$("[data-share-dialog]").bind("click",function(r){r.preventDefault();var d=$(this),l=d.data("dialog-title"),u=$(d.data("share-dialog")).html();if($(d).hasClass("cls_abnormal"))return void(window.show_abnormal&&window.show_abnormal());window.sharingDialog=t({title:l,content:u}),setTimeout(function(){sharingDialog.update().open()},20);var c=sharingDialog.node,s=(c.find(".notification"),c.find("textarea")),f=c.find(".avail-num-indicator"),g=c.find(":submit"),h=c.find(".mentioned-highlighter");c.addClass("movie-share-dialog"),a(s.get(0),0),n(s),s.bind("actualChange",function(){i(s,f)}),s.textbox({itemCount:6,dataUrl:s.data("mention-api"),listTmpl:$("#suggest-mention-tmpl").html(),highlighter:h}),i(s,f),s.bind({limitExceed:function(){g.attr("disabled",!0)},limitFufill:function(){g.removeAttr("disabled")}});var m=c.find("form"),v=c.find(".error"),b=m.find("input").add(m.find("textarea"));m.bind("afterSubmit",function(){v.hide(),b.attr("disabled",!0)}),e(m,function(t){return t.r?(sharingDialog.setContent(['<p class="dialog-only-text">',"分享成功!","</p>"].join("")).set({height:155}),void setTimeout(function(){sharingDialog.close()},1500)):(c.find(".error").hide().text(t.reason||"服务器开小差了，请稍候再试……").fadeIn(),void b.removeAttr("disabled"))},"json",function(t){return"text"===t.name&&(t.value=o(h)||t.value),t})});var l=document.selection?function(t,e,a){var n=t.createTextRange();n.moveEnd("character",-t.value.length),n.moveEnd("character",a),n.moveStart("character",e),n.select()}:function(t,e,a){t.setSelectionRange(e,a),t.focus()}});